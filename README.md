# Algoritmo de Dijkstra com Visualiza√ß√£o de Grafos OSM

Uma implementa√ß√£o completa do algoritmo de caminho mais curto de Dijkstra com suporte a arquivos OpenStreetMap (OSM) e interface gr√°fica baseada em GTK.

## Caracter√≠sticas

- **Leitura de Arquivos OSM**: Analisa arquivos XML do OpenStreetMap para extrair n√≥s e caminhos
- **Estruturas de Dados de Grafo**: Armazenamento eficiente de pontos, arestas e pesos
- **Algoritmo de Dijkstra**: Implementa√ß√£o completa com fila de prioridade (min-heap)
- **Interface GTK**: Interface gr√°fica amig√°vel para carregamento e visualiza√ß√£o de arquivos
- **Visualiza√ß√£o de Grafos**: Renderiza√ß√£o em tempo real do grafo usando Cairo com controles de zoom e panor√¢mica
- **Sele√ß√£o Interativa de Pontos**: Clique diretamente nos pontos do mapa usando Ctrl+click para selecionar n√≥s de in√≠cio/fim
- **Controles do Mouse**: Zoom com roda do mouse, arrastar para navegar, navega√ß√£o intuitiva
- **Busca de Caminhos**: C√°lculo interativo de caminhos entre pontos selecionados com feedback visual
- **Diferencia√ß√£o Visual**: Pontos selecionados s√£o destacados com cores diferentes (verde=in√≠cio, vermelho=fim)
- **üõ£Ô∏è Grafos Direcionados**: Suporte completo a vias de m√£o √∫nica e m√£o dupla com parsing de tags OSM
- **Visualiza√ß√£o de Dire√ß√£o**: Arestas direcionais mostradas em azul com setas, bidirecionais em cinza

## üõ£Ô∏è **Suporte a Grafos Direcionados**

O projeto agora suporta diferentes tipos de vias para representar o tr√¢nsito real:

### Tipos de Via Suportados:
- **üîÑ Vias Bidirecionais**: Ruas normais de m√£o dupla (padr√£o)
- **‚û°Ô∏è Vias de M√£o √önica**: Ruas com dire√ß√£o √∫nica obrigat√≥ria  
- **‚¨ÖÔ∏è Vias Reversas**: Vias de m√£o √∫nica na dire√ß√£o oposta

### Tags OSM Reconhecidas:
```xml
<!-- Via bidirecional (padr√£o) -->
<way id="123">
  <tag k="highway" v="residential"/>
</way>

<!-- Via de m√£o √∫nica -->
<way id="124">
  <tag k="highway" v="residential"/>
  <tag k="oneway" v="yes"/>
</way>

<!-- Via de m√£o √∫nica reversa -->
<way id="125">
  <tag k="highway" v="residential"/>
  <tag k="oneway" v="-1"/>
</way>
```

### Visualiza√ß√£o:
- **Arestas Bidirecionais**: Linhas cinzas sem setas
- **Arestas Direcionais**: Linhas azuis com setas indicando dire√ß√£o
- **Caminhos Dijkstra**: Sempre em vermelho, independente do tipo

### Algoritmo:
- **Dijkstra Consciente de Dire√ß√£o**: O algoritmo respeita automaticamente as restri√ß√µes de dire√ß√£o
- **Busca Otimizada**: S√≥ explora arestas na dire√ß√£o permitida
- **Caminhos V√°lidos**: Garante que todos os caminhos encontrados respeitam o tr√¢nsito

### Detec√ß√£o Autom√°tica OSM:
O parser OSM detecta automaticamente tags de via √∫nica:
- `<tag k="oneway" v="yes"/>` ou `v="true"` ou `v="1"` ‚Üí Via de m√£o √∫nica normal
- `<tag k="oneway" v="-1"/>` ou `v="reverse"/>` ‚Üí Via de m√£o √∫nica reversa
- Aus√™ncia da tag oneway ‚Üí Via bidirecional (padr√£o)

### Algoritmo de Dijkstra Atualizado:
- Respeita as dire√ß√µes das vias durante o c√°lculo de caminhos
- Vias de m√£o √∫nica s√≥ podem ser percorridas na dire√ß√£o correta
- Vias bidirecionais podem ser percorridas em ambas as dire√ß√µes

### Visualiza√ß√£o Diferenciada:
- **Cores**: Cinza para bidirecionais, azul para m√£o √∫nica
- **Setas**: Setas azuis indicam a dire√ß√£o permitida em vias de m√£o √∫nica
- **Estat√≠sticas**: Interface mostra contagem de vias de cada tipo

### Exemplo de Teste:
Use o arquivo `test_oneway.osm` inclu√≠do para testar a funcionalidade com diferentes tipos de via.

## Depend√™ncias

- **GTK+ 3.0**: Framework de interface gr√°fica
- **Cairo**: Biblioteca de gr√°ficos 2D para renderiza√ß√£o de grafos
- **libxml2**: An√°lise XML para arquivos OSM
- **GLib/GIO**: Bibliotecas principais
- **Biblioteca Math**: Fun√ß√µes matem√°ticas (dist√¢ncia Haversine)
- **Meson**: Sistema de compila√ß√£o
- **Ninja**: Backend de compila√ß√£o

## Instala√ß√£o de Depend√™ncias

###  Linux (Ubuntu/Debian)

```bash
# Atualizar reposit√≥rios
sudo apt update

# Instalar depend√™ncias principais
sudo apt install -y \
    build-essential \
    meson \
    ninja-build \
    pkg-config \
    libgtk-3-dev \
    libcairo2-dev \
    libxml2-dev \
    libglib2.0-dev \
    libgio-2.0-dev

# Verificar instala√ß√£o
meson --version
ninja --version
pkg-config --modversion gtk+-3.0
```

###  Linux (Arch Linux)

```bash
# Instalar depend√™ncias
sudo pacman -S \
    base-devel \
    meson \
    ninja \
    pkg-config \
    gtk3 \
    cairo \
    libxml2 \
    glib2
```

###  Windows

#### Op√ß√£o 1: MSYS2 (Recomendado)

1. **Baixar e instalar MSYS2**:
   - Baixe de: https://www.msys2.org/
   - Execute o instalador e siga as instru√ß√µes

2. **Abrir terminal MSYS2 MINGW64** e instalar depend√™ncias:
```bash
# Atualizar pacotes
pacman -Syu

# Instalar toolchain de desenvolvimento
pacman -S --needed \
    mingw-w64-x86_64-toolchain \
    mingw-w64-x86_64-meson \
    mingw-w64-x86_64-ninja \
    mingw-w64-x86_64-pkg-config \
    mingw-w64-x86_64-gtk3 \
    mingw-w64-x86_64-cairo \
    mingw-w64-x86_64-libxml2 \
    mingw-w64-x86_64-glib2

# Verificar instala√ß√£o
meson --version
ninja --version
```

#### Op√ß√£o 2: Visual Studio + vcpkg

1. **Instalar Visual Studio Community 2022**:
   - Baixe de: https://visualstudio.microsoft.com/pt-br/vs/community/
   - Inclua "Desenvolvimento para Desktop com C++"

2. **Instalar vcpkg**:
```cmd
git clone https://github.com/Microsoft/vcpkg.git
cd vcpkg
.\bootstrap-vcpkg.bat
.\vcpkg integrate install
```

3. **Instalar depend√™ncias**:
```cmd
.\vcpkg install gtk:x64-windows
.\vcpkg install cairo:x64-windows
.\vcpkg install libxml2:x64-windows
.\vcpkg install glib:x64-windows
```

4. **Instalar Meson e Ninja**:
```cmd
pip install meson ninja
```

###  macOS

```bash
# Instalar Homebrew (se n√£o tiver)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Instalar depend√™ncias
brew install \
    meson \
    ninja \
    pkg-config \
    gtk+3 \
    cairo \
    libxml2 \
    glib

# Verificar instala√ß√£o
meson --version
ninja --version
pkg-config --modversion gtk+-3.0
```

## Compila√ß√£o

Este projeto usa o sistema de compila√ß√£o Meson:

### Linux/macOS:
```bash
# Configurar compila√ß√£o
meson setup build

# Compilar
ninja -C build

# Executar
./build/DijikstrasProject

# Alternativa: Executar do builddir
./builddir/DijikstrasProject
```

### Windows (MSYS2):
```bash
# No terminal MSYS2 MINGW64
meson setup build
ninja -C build
./build/DijikstrasProject.exe
```

### Windows (Visual Studio):
```cmd
# Usando Developer Command Prompt
meson setup build --backend vs
meson compile -C build
.\build\DijikstrasProject.exe
```


## Uso Interativo

### Controles do Mouse
- **Zoom**: Use a roda do mouse para ampliar/reduzir (limitado entre 0.1x e 50x) - centralizado no cursor
- **Panor√¢mica**: Clique e arraste com o bot√£o esquerdo para mover pelo mapa
- **Sele√ß√£o de Pontos**: Segure Ctrl e clique nos pontos para selecion√°-los para busca de caminhos

### Fluxo de Trabalho da Sele√ß√£o de Pontos
1. **Carregar Arquivo OSM**: Use Arquivo ‚Üí Abrir OSM ou bot√£o da barra de ferramentas
2. **Selecionar Ponto de In√≠cio**: Segure Ctrl e clique em qualquer ponto (fica verde)
3. **Selecionar Ponto de Fim**: Segure Ctrl e clique em outro ponto (fica vermelho)  
4. **Encontrar Caminho**: Clique no bot√£o "Encontrar Caminho" ou digite os IDs dos pontos manualmente
5. **Resetar Sele√ß√£o**: Segure Ctrl e clique novamente para come√ßar de novo

### üîß **Modos de Edi√ß√£o**

A aplica√ß√£o agora inclui ferramentas completas de edi√ß√£o de grafos:

#### Modos Dispon√≠veis:
- **üü¢ Modo Normal**: Navega√ß√£o e sele√ß√£o de pontos para Dijkstra (padr√£o)
- **‚ûï Modo Criar**: Clique em espa√ßo vazio para criar novos n√≥s
- **‚ùå Modo Deletar**: Clique em n√≥s para delet√°-los (com valida√ß√£o de conex√µes)
- **üîó Modo Conectar**: Clique em dois n√≥s para conect√°-los com c√°lculo autom√°tico de dist√¢ncia

#### Como Usar os Modos de Edi√ß√£o:
1. **Ativar Modo**: Clique nos bot√µes da barra de ferramentas (Create Node, Delete Node, Connect Nodes, Normal Mode)
2. **Feedback Visual**: Os n√≥s mudam de cor baseado no modo ativo:
   - Verde claro: Modo criar
   - Vermelho claro: Modo deletar  
   - Azul claro: Modo conectar
   - Azul escuro: N√≥ selecionado para conex√£o
   - Laranja: N√≥ selecionado para edi√ß√£o
3. **Opera√ß√µes**:
   - **Criar**: Clique em qualquer lugar vazio para adicionar um novo n√≥
   - **Deletar**: Clique em um n√≥ para remov√™-lo (s√≥ permite n√≥s com ‚â§2 conex√µes)
   - **Conectar**: Clique no primeiro n√≥, depois no segundo para criar uma aresta
   - **Normal**: Retorna ao modo padr√£o de navega√ß√£o e sele√ß√£o Dijkstra

#### Caracter√≠sticas Avan√ßadas:
- **C√°lculo autom√°tico de dist√¢ncia**: Novas conex√µes usam f√≥rmula Haversine
- **Valida√ß√£o de opera√ß√µes**: Previne deletar n√≥s cr√≠ticos com muitas conex√µes
- **IDs autom√°ticos**: Novos n√≥s recebem IDs √∫nicos automaticamente
- **Zoom centrado no mouse**: Zoom mais intuitivo e preciso
- **Visualiza√ß√£o completa de caminhos**: Caminhos Dijkstra mostram rota completa em vermelho

### Entrada Manual de Pontos
- Digite o ID do ponto de in√≠cio no campo "Ponto de In√≠cio"
- Digite o ID do ponto de fim no campo "Ponto de Fim"
- Clique em "Encontrar Caminho" para calcular a rota mais curta
- Veja os resultados no painel de resultados

## Testes e Depura√ß√£o

O projeto inclui programas de teste abrangentes no diret√≥rio `test/`:

### Programas de Teste
- `test/test_events.c` - Teste b√°sico de detec√ß√£o de eventos
- `test/test_simple_selection.c` - Teste abrangente de sele√ß√£o de pontos
- `test/verify_fix.sh` - Verifica√ß√£o automatizada do projeto
- `test/test_debug.c` - Programa de depura√ß√£o geral
- `test/test_coordinates.c` - Teste de coordenadas
- `test/test_draw.c` - Teste de fun√ß√µes de desenho
- `test/test_locale.c` - Teste de configura√ß√µes de localiza√ß√£o
- `test/test_parsing.c` - Teste de an√°lise de arquivos
- `test/test_point_selection.c` - Teste espec√≠fico de sele√ß√£o de pontos
- `test/test_app_debug.c` - Depura√ß√£o da aplica√ß√£o principal

### Executando os Testes
```bash
# Executar script de verifica√ß√£o
./test/verify_fix.sh

# Compilar e executar testes individuais
cd test/
gcc `pkg-config --cflags gtk+-3.0` -o test_events test_events.c `pkg-config --libs gtk+-3.0`
./test_events

# Compilar teste de sele√ß√£o de pontos
gcc -I../include `pkg-config --cflags gtk+-3.0` -o test_simple_selection test_simple_selection.c ../src/osm_reader.c ../src/graph.c ../src/dijkstra.c `pkg-config --libs gtk+-3.0` -lxml2 -lm
./test_simple_selection
```

## Estrutura do Projeto

```
üìÅ DijkstrasProject/
‚îú‚îÄ‚îÄ üìÑ README.md              # Documenta√ß√£o principal
‚îú‚îÄ‚îÄ üìÑ meson.build            # Configura√ß√£o de compila√ß√£o
‚îú‚îÄ‚îÄ üìÑ casaPrimo.osm          # Arquivo OSM de exemplo
‚îú‚îÄ‚îÄ üìÅ src/                   # C√≥digo fonte principal
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ main.c            # Interface gr√°fica e controle principal
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ osm_reader.c      # Leitor de arquivos OSM
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ dijkstra.c        # Implementa√ß√£o do algoritmo
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ graph.c           # Estruturas de dados do grafo
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ edit.c            # Funcionalidades de edi√ß√£o (NOVO!)
‚îú‚îÄ‚îÄ üìÅ include/               # Cabe√ßalhos
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ osm_reader.h
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ dijkstra.h
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ graph.h
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ edit.h            # API de edi√ß√£o (NOVO!)
‚îú‚îÄ‚îÄ üìÅ data/                  # Recursos da interface
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ my_window.ui      # Layout GTK Glade
‚îú‚îÄ‚îÄ üìÅ test/                  # Programas de teste
‚îî‚îÄ‚îÄ üìÅ builddir/              # Arquivos compilados
```

## Caracter√≠sticas T√©cnicas

### Algoritmos Implementados:
- **Dijkstra com Min-Heap**: Implementa√ß√£o otimizada com fila de prioridade
- **Haversine**: C√°lculo de dist√¢ncia geod√©sica entre coordenadas
- **Transforma√ß√£o de Coordenadas**: Convers√£o lat/lon ‚Üî coordenadas de tela
- **Detec√ß√£o de Cliques**: Sistema robusto de sele√ß√£o de pontos pr√≥ximos

### Tecnologias Utilizadas:
- **C11**: Linguagem de programa√ß√£o principal
- **GTK+ 3.0**: Framework de interface gr√°fica cross-platform
- **Cairo**: Renderiza√ß√£o de gr√°ficos vetoriais 2D
- **libxml2**: Parser XML para arquivos OpenStreetMap
- **Meson + Ninja**: Sistema moderno de compila√ß√£o

### Arquivos Importantes:
- `src/edit.c` + `include/edit.h`: Sistema completo de edi√ß√£o de grafos
- `src/dijkstra.c`: Algoritmo com reconstru√ß√£o completa de caminhos
- `src/main.c`: Interface gr√°fica com zoom centrado no mouse
- `data/my_window.ui`: Layout da interface com bot√µes de edi√ß√£o
